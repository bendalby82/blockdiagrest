<html>
<head><title>Test Drawing</title>
<script>
/*
TODO: Make box width dynamic based on length of text
TODO: Make arrow width dynamic based on length of text


*/
function textCentredXCoordinate(context, containerX, containerWidth, txtLine){
	//Given an arbitrary container, what X coordinate should we start a line
	//of text at so that it appears centred?
	var txtLineWidth = context.measureText(txtLine).width;
	return (containerX + parseInt((containerWidth - txtLineWidth) / 2));
}


function drawVSPBox(context, vspBoxPosX, vspBoxPosY, txtStepName, txtStepWorkTime, txtStepElapsedTime, txtStepWaitTime){

	var textStyleStageName = 'bold 14px arial';
	var vspBoxWidth = 120;
	var vspBoxHeight = 70;
	var txtLine = '';
	var txtLineWidth = 0;
	var txtLineHeight = 0;
	var vspLine1Width = 0;
	var vspLine2Width = 0;
	var vspLine3Width = 0;
	var vspLine4Width = 0;
	var vspLinePosY = 0;
	var vspSpaceBetweenTextLines = 6;
	var elapsedTimeBoxWidth = 0;
	var elapsedTimeBoxHeight = 20;

	//Draw a Value Stream Box
	context.rect(vspBoxPosX,vspBoxPosY,vspBoxWidth,vspBoxHeight);
	context.shadowColor = 'black';
	context.shadowBlur = 5;
	context.shadowOffsetX = 3;
	context.shadowOffsetY = 3;
	context.fillStyle = '#00ccff';
	context.stroke();
	context.fill();

	//Add some text
	context.beginPath();
	context.shadowColor = 'transparent';
	context.font = textStyleStageName;
	context.fillStyle = 'black';
	txtLine = txtStepName;
	vspLinePosY = vspBoxPosY + 30;
	context.fillText(txtLine,parseInt((vspBoxWidth - context.measureText(txtLine).width)/2) + vspBoxPosX, vspLinePosY);
	context.font = '14px arial';
	txtLineHeight = context.measureText('M').width;

	txtLine = txtStepWorkTime;
	vspLinePosY = vspLinePosY + txtLineHeight + vspSpaceBetweenTextLines;
	context.fillText(txtLine, parseInt((vspBoxWidth - context.measureText(txtLine).width)/2) + vspBoxPosX, vspLinePosY);

	context.beginPath();
	txtLine = txtStepElapsedTime;
	txtLineWidth = context.measureText(txtLine).width;
	//See https://stackoverflow.com/questions/1134586/how-can-you-find-the-height-of-text-on-an-html-canvas
	txtLineHeight = context.measureText('M').width;
	elapsedTimeBoxWidth = txtLineWidth + 20;
	context.rect(parseInt((vspBoxWidth - elapsedTimeBoxWidth)/2) + vspBoxPosX,vspBoxPosY + vspBoxHeight + 10,elapsedTimeBoxWidth,elapsedTimeBoxHeight);
	context.fillStyle = '#cccccc';
	context.fill();

	context.beginPath();
	context.fillStyle = 'black';
	//Center text horizontally and vertically
	context.fillText(txtLine, parseInt((vspBoxWidth - txtLineWidth)/2) + vspBoxPosX,
		vspBoxPosY + vspBoxHeight + 10 + 
		elapsedTimeBoxHeight - parseInt((elapsedTimeBoxHeight - txtLineHeight)/2));
	//context.closePath();

	if (txtStepWaitTime) {
		//Draw an arrow
		context.beginPath();
		var arrowLength = 60
		var arrowX = vspBoxPosX - arrowLength;
		var arrowY = vspBoxPosY + parseInt(vspBoxHeight / 2);
		context.moveTo(arrowX, arrowY);
		context.lineTo(arrowX + arrowLength, arrowY);
		context.moveTo(arrowX + arrowLength - 5, arrowY - 5);
		context.lineTo(arrowX + arrowLength, arrowY);
		context.lineTo(arrowX + arrowLength - 5, arrowY + 5);
		context.strokeStyle = "black";
		context.stroke();

		context.fillText(txtStepWaitTime, textCentredXCoordinate(context, arrowX, arrowLength, txtStepWaitTime), arrowY - 10);


	}

}

function drawStuff(){
	var b_canvas = document.getElementById("a");
	var context = b_canvas.getContext("2d");
	drawVSPBox(context, 20, 20, "Planning", "60 hr avg", "120 hrs", "");
	drawVSPBox(context, 200,20, "Design", "10 hrs", "24hrs", "10 hrs");


}

</script>
</head>
<body onload="drawStuff()">
<!--http://diveintohtml5.info/canvas.html-->
<canvas id="a" width="800" height="375" class="clear" style="border:1px dotted;float:left"></canvas>

</body>
</html>